SELECT 
    a.sName AS CallsNo,a.RequestDate AS [$Date$Request Date],a.sSubject AS sSubject,b.sName AS Branch,
    c.sName AS BranchLocation,d.sName AS [Asset Name],a.iDueDate AS [$Date$Due Date],e.sName AS [Status],f.sName AS CallState,
    g.sName AS [Priority],h.sName AS [Owner],j.sName AS col13,i.sName AS [Request Created],i.iCreatedDate AS [$Datetime$CreatedDate],
    a.iFirstRespDue AS [$Datetime$FirstRespDue],a.iResPlanDue AS [$Datetime$ResPlanDue],a.iResolvedDue AS [$Datetime$ResolvedDue], 
    CASE a.TypeOfCall WHEN '1' THEN N'Repair' WHEN '2' THEN N'Installation' WHEN '3' THEN N'PM CALL' END AS TypeOfCall
FROM vCrm_Calls a WITH(NOLOCK)
LEFT JOIN vCore_MainBranch b WITH(NOLOCK) ON a.MainBranch = b.iMasterId  
LEFT JOIN vCore_Location c WITH(NOLOCK) ON b.iLocation = c.iMasterId  
LEFT JOIN vCrm_CustAssets d WITH(NOLOCK) ON a.iCustAssetId = d.iTransId  
LEFT JOIN vCrm_RequestStatus e WITH(NOLOCK) ON a.iStatusId = e.iTransId  
LEFT JOIN vCrm_RequestState f WITH(NOLOCK) ON a.iCallStateId = f.iTransId  
LEFT JOIN vCrm_Priority g WITH(NOLOCK) ON a.iPriorityId = g.iTransId  
LEFT JOIN vCrm_Users h WITH(NOLOCK) ON a.iAssignedTo = h.iMasterId  
LEFT JOIN vCore_RapiscanUser i WITH(NOLOCK) ON a.RequestCreatedBy = i.iMasterId  
LEFT JOIN vCrm_Users j WITH(NOLOCK) ON i.iAssignedTo = j.iMasterId   
WHERE a.iTransId > 0   
    AND (a.iDueDate BETWEEN @STARTDATE AND @ENDDATE)
    AND dbo.fCrm_DATEDIFF(1,a.iDueDate,dbo.fCore_DateToInt(GETDATE()))<105



