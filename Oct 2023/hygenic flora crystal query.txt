CREATE VIEW nCore_QuoteGrid as

select iTransId,QuoteNo,QuoteDate,EnquiryDate,Datafield,mul,CONCAT(ItemCode,'  ',Product,'  ',Remarks) ProductCode,type,val,Account  from
(
select a.iTransId,ISNULL(a.sName,'') [QuoteNo],b.sName [Product],c.sName [Account],FORMAT(dbo.fCore_IntToDate(Date),'dd/MM/yyyy') [QuoteDate],CASE when EnquiryDate is null then null else FORMAT(dbo.fCore_IntToDate(EnquiryDate),'dd/MM/yyyy') end [EnquiryDate],a.Datafield,ISNULL(a.ItemCode,'') ItemCode,ISNULL(a.Remarkssg,'') Remarks,ISNULL(a.Thkmm1,0) [Th MM],ISNULL(a.NBmmSG,0) [NB mm],'*' mul,ISNULL(a.NBmmSG2,0) [NB mm1],
ISNULL(a.LengthmmSG,0) LengthmmSG ,ISNULL(a.QtyNos,0) QtyNos,ISNULL(a.UnitPriceRs,0) UnitPriceRs,ISNULL(a.TotalPriceRs,0) TotalPriceRs ,
ISNULL(a.Value,0) [Value]
from vuCrm_Quote_StandardGrid_Details a
LEFT OUTER JOIN vCore_Product b on a.Product=b.iMasterId
LEFT OUTER JOIN vCore_Account c on a.AccountName=c.iMasterId
where iTransId>0 
) a
unpivot (
val for [type] in ([Th MM],[NB mm],[NB mm1],LengthmmSG,QtyNos,UnitPriceRs,TotalPriceRs,[Value])
) as unpvt

select * from nCore_QuoteGrid where  iTransId={?iTransId}
==========================================================================

ALTER VIEW nCore_Quote as
select iTransId,a.sName [QuoteNo],FORMAT(dbo.fCore_IntToDate([Date]),'dd/MM/yyyy') [QuoteDate],Datafield,b.sName [AccountName],c.sName [Location],d.sName [Contact],
CASE when EnquiryDate is null then null else FORMAT(dbo.fCore_IntToDate(EnquiryDate),'dd/MM/yyyy') end  [Enquire Date],e.sName [Attachment Type]  from vuCrm_Quote_AttachmentsList_Details a with(nolock)
left join vCore_Account b with(nolock) on a.AccountName=b.iMasterId
left join vCore_AddressMaster c with(nolock) on a.Ad=c.iMasterId
left join vCrm_Contacts d with(nolock) on b.iMasterId=d.iAccountId
left join vCore_AttachmentsList e with(nolock) on a.AttachmentType=e.iMasterId
where a.iTransId>0
=========================================================================

select iTransId,AttachmentnewName,a.sName [quoteNo],'HYGENIC FLORA PVT.LTD' [Header],b.sName AccountName,
CONCAT('http://localhost:8080/ResourceFromCRM/getres?cc=01140&docid=',iDocsId) Attachment
from vuCrm_Quote_AttachmentsList_Details a
LEFT JOIN vCore_Account b on a.AccountName=b.iMasterId
left JOIN (select  dbo.fCrm_getAPITransId(vCrm_Documents.iMasterId,2563,0) iDocsId,iRelatedTo,iIndex
from vCrm_Documents with(nolock)
where iModuleTypeId=2816 and iFieldId=301044) Docs on Docs.iRelatedTo=a.iTransId and Docs.iIndex=a.iSequence
where a.iTransId>0 and a.iTransId={?iTransId}
=========================================================================

select validity,Delivery,CASE FREIGHT when 1 then 'You' when 2 then 'Us' end ,
CASE PaymentTerms when 1 then '100% against Proforma Invoice prior to dispatch.'
when 2 then '100% against proforma invoice prior along with the Purchase Order.' end PaymentTerms
from vCrm_Quote where iTransId>0 and iTransId={?iTransId}